<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏î (Live Race) - ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏µ‡∏¨‡∏≤‡∏™‡∏µ</title>
    
    <link rel="icon" href="https://img5.pic.in.th/file/secure-sv1/IMG_602976b5b060daac652b.png" type="image/png">
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #007bff;
            --light-blue: #e0f2f7;
            --primary-pink: #fd7e14;
            --light-pink: #fff3e0;
            --text-primary: #343a40;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --background-gradient: linear-gradient(135deg, var(--light-blue) 0%, var(--light-pink) 100%);
            --card-bg: #ffffff;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.15);
        }
        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 30px;
            background: var(--background-gradient);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            line-height: 1.6;
        }
        .container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 30px var(--shadow-medium);
            max-width: 1000px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .logo {
            height: 60px;
            margin-right: 15px;
        }
        h1 {
            color: var(--primary-blue);
            font-size: 2.8em;
            margin: 0;
            font-weight: 700;
        }
        
        /* ‚≠êÔ∏è (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏°‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á" ‚≠êÔ∏è */
        .race-container {
            width: 100%;
            padding: 20px 0;
            box-sizing: border-box;
        }

        .horse-track {
            margin-bottom: 15px;
            background-color: var(--bg-tertiary, #f3f4f6);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .horse-bar {
            height: 50px;
            width: 0%; /* ‚≠êÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 0 */
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            
            /* ‚≠êÔ∏è (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Animation ‚≠êÔ∏è */
            transition: width 1.5s cubic-bezier(0.23, 1, 0.32, 1); 
            
            border-radius: 0 8px 8px 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            color: white;
            font-weight: 600;
            font-size: 1.2em;
            overflow: visible; /* ‚≠êÔ∏è ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ ‡πÅ‡∏°‡πâ‡∏ö‡∏≤‡∏£‡πå‡∏à‡∏∞‡∏™‡∏±‡πâ‡∏ô */
            position: relative;
        }

        .horse-label {
            padding: 0 10px;
            white-space: nowrap;
            text-align: left;
            font-size: 1.1em;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .horse-score {
            position: absolute;
            right: -50px; /* ‚≠êÔ∏è ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡∏≤‡∏£‡πå */
            padding-left: 10px;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.1em;
        }
        
        /* ‚≠êÔ∏è (‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô CSS ‡πÉ‡∏´‡∏°‡πà) ‚≠êÔ∏è */


        .status-bar {
            margin-top: 25px;
            color: var(--text-secondary);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @media (max-width: 768px) {
            body { padding: 15px; }
            .container { padding: 20px; }
            h1 { font-size: 2em; }
            .horse-bar { height: 40px; font-size: 1em; }
            .horse-label { font-size: 1em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <img src="https://img5.pic.in.th/file/secure-sv1/IMG_60290ec6a71fd92a13d0.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="logo">
            <h1>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï (Live Race)</h1>
        </header>

        <div class="race-container" id="race-container">
            </div>

        <div class="status-bar">
            <div class="spinner" id="loading-spinner"></div>
            <span id="last-updated">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
        </div>
    </div>

    <script>
        // üö® (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß!) ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤ üö®
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwwJzP_jTHieO4asdyGAJk1hYHxP5gYSIZu2XNp_myLqtAqxmMMsekofM4Xl3GguKlvCQ/exec';
        
        const REFRESH_INTERVAL = 10000; // ‚≠êÔ∏è (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï) 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        const raceContainer = document.getElementById('race-container');
        const statusText = document.getElementById('last-updated');
        const loadingSpinner = document.getElementById('loading-spinner');
        let isFirstLoad = true; // ‚≠êÔ∏è (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Call API (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢)
         */
        async function callApi(action, data = {}) {
            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ action, ...data }),
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error calling API:', error);
                statusText.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
                return { status: 'error' };
            }
        }

        /**
         * ‚≠êÔ∏è (‡πÉ‡∏´‡∏°‡πà) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡∏°‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á ‚≠êÔ∏è
         */
        function displayVoteRace(votes) {
            if (votes.length === 0) { 
                statusText.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï';
                return;
            }
            
            // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            votes.sort((a, b) => b.voteCount - a.voteCount);
            const maxVotes = Math.max(1, votes[0].voteCount); // ‚≠êÔ∏è (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ 0)

            // 2. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü
            votes.forEach((vote, index) => {
                const percentage = (vote.voteCount / maxVotes) * 100;
                
                // ‚≠êÔ∏è ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏´‡∏≤‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏î‡∏¥‡∏°
                let track = document.getElementById(`track-${vote.designId}`);
                let bar, score;

                if (!track) {
                    // ‚≠êÔ∏è ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏Å‡πá‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    track = document.createElement('div');
                    track.id = `track-${vote.designId}`;
                    track.className = 'horse-track';
                    
                    track.innerHTML = `
                        <div class="horse-label">${vote.designName} (${vote.designId})</div>
                        <div class="horse-bar" id="bar-${vote.designId}">
                            <span class="horse-score">${vote.voteCount}</span>
                        </div>
                    `;
                    raceContainer.appendChild(track);
                    bar = track.querySelector('.horse-bar');
                    score = track.querySelector('.horse-score');

                    // ‚≠êÔ∏è ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 0 ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ß‡∏¥‡πà‡∏á
                    if (isFirstLoad) {
                        setTimeout(() => {
                            bar.style.width = percentage + '%';
                        }, 100 * (index + 1)); // ‚≠êÔ∏è ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                    } else {
                        bar.style.width = percentage + '%';
                    }

                } else {
                    // ‚≠êÔ∏è ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
                    bar = track.querySelector('.horse-bar');
                    score = track.querySelector('.horse-score');
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞ % ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á (CSS Transition ‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Animation ‡πÄ‡∏≠‡∏á)
                    score.textContent = vote.voteCount;
                    bar.style.width = percentage + '%';
                }
                
                // ‚≠êÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏µ (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
                const colors = [
                    'linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%)', // ‡∏°‡πà‡∏ß‡∏á
                    'linear-gradient(90deg, #10b981 0%, #3b82f6 100%)', // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÑ‡∏õ‡∏ü‡πâ‡∏≤
                    'linear-gradient(90deg, #f59e0b 0%, #ef4444 100%)', // ‡∏™‡πâ‡∏°‡πÑ‡∏õ‡πÅ‡∏î‡∏á
                    'linear-gradient(90deg, #22d3ee 0%, #0e7490 100%)'  // ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏°
                ];
                bar.style.background = colors[index % colors.length];

                // ‚≠êÔ∏è ‡πÄ‡∏ô‡πâ‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)
                if (index === 0 && vote.voteCount > 0) {
                    bar.style.background = 'linear-gradient(90deg, #fde047 0%, #f97316 100%)'; // ‚≠êÔ∏è ‡∏™‡∏µ‡∏ó‡∏≠‡∏á
                }
            });

            isFirstLoad = false; // ‚≠êÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
        }


        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
         */
        async function loadData() {
            loadingSpinner.style.display = 'inline-block';
            
            const response = await callApi('getVoteResults');
            
            if (response.status === 'success' && response.results) {
                displayVoteRace(response.results); // ‚≠êÔ∏è (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà
                const now = new Date();
                statusText.textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${now.toLocaleTimeString('th-TH')}`;
            } else {
                statusText.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ';
            }
            
            loadingSpinner.style.display = 'none';
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô!
        loadData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        setInterval(loadData, REFRESH_INTERVAL); // ‚≠êÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏´‡∏•‡∏î‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

    </script>

</body>
</html>
