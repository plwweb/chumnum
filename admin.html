<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบลงทะเบียนกิจกรรมชุมนุม - ร.ร.ภูหลวงวิทยา</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" 
          rel="stylesheet">

    <style>
        /* 3. ใช้ Font ที่เรานำเข้า */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f7f6; /* สีพื้นหลังเทาอ่อน */
        }
    </style>
</head>
<body>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                
                <header class="text-center mb-4">
                    <h1 class="h3 mb-2 fw-bold">ระบบลงทะเบียนกิจกรรมชุมนุม</h1>
                    <p class="text-muted">โรงเรียนภูหลวงวิทยา</p>
                </header>

                <div class="card shadow-sm border-0">
                    <div class="card-header bg-primary text-white">
                        <h5 class="my-1">กรอกข้อมูลเพื่อลงทะเบียน</h5>
                    </div>
                    <div class="card-body p-4 p-md-5">

                        <div class="alert alert-success d-none" role="alert" id="alertSuccess">
                            <strong>ลงทะเบียนสำเร็จ!</strong> ข้อมูลของคุณถูกบันทึกเรียบร้อยแล้ว
                        </div>
                        <div class="alert alert-danger d-none" role="alert" id="alertError">
                            <strong>เกิดข้อผิดพลาด!</strong> ไม่สามารถบันทึกข้อมูลได้: <span id="errorMessage"></span>
                        </div>

                        <form id="registrationForm">
                            <div class="mb-3">
                                <label for="studentID" class="form-label">รหัสนักเรียน</label>
                                <input type="text" class="form-control" id="studentID" placeholder="เช่น 65001" required>
                            </div>
                            <div class="mb-3">
                                <label for="studentName" class="form-label">ชื่อ - สกุล</label>
                                <input type="text" class="form-control" id="studentName" placeholder="เช่น เด็กชายภูหลวง วิทยานนท์" required>
                            </div>
                            <div class="mb-3">
                                <label for="clubID" class="form-label">รหัสชุมนุม</label>
                                <input type="text" class="form-control" id="clubID" placeholder="เช่น C001" required>
                            </div>
                            <div class="mb-3">
                                <label for="clubName" class="form-label">ชื่อชุมนุม</label>
                                <input type="text" class="form-control" id="clubName" placeholder="เช่น ชุมนุมรักการอ่าน" required>
                            </div>
                            
                            <hr class="my-4">
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="submitButton">
                                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true" id="loadingSpinner"></span>
                                    ยืนยันการลงทะเบียน
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <footer class="text-center text-muted mt-4">
                    <small>งานกิจกรรมพัฒนาผู้เรียน โรงเรียนภูหลวงวิทยา<br>&copy; 2025</small>
                </footer>

            </div>
        </div>
    </div>

    <script>
        // -----------------------------------------------------------
        // !!! สำคัญ !!! 
        // วาง URL ของ GOOGLE APPS SCRIPT WEB APP ของคุณที่นี่
        const GOOGLE_SCRIPT_URL = "YOUR_WEB_APP_URL_HERE"; 
        // -----------------------------------------------------------

        // เลือก Element ต่างๆ
        const form = document.getElementById('registrationForm');
        const submitButton = document.getElementById('submitButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const alertSuccess = document.getElementById('alertSuccess');
        const alertError = document.getElementById('alertError');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', function(e) {
            e.preventDefault(); // ป้องกันการรีเฟรชหน้า

            // 1. แสดงสถานะกำลังโหลด
            submitButton.disabled = true;
            loadingSpinner.classList.remove('d-none');
            alertSuccess.classList.add('d-none');
            alertError.classList.add('d-none');

            // 2. รวบรวมข้อมูลจากฟอร์ม
            const data = {
                studentID: document.getElementById('studentID').value,
                studentName: document.getElementById('studentName').value,
                clubID: document.getElementById('clubID').value,
                clubName: document.getElementById('clubName').value,
            };

            // 3. ส่งข้อมูลไปยัง Google Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // 'no-cors' สำหรับการส่งข้ามโดเมนแบบง่าย
                cache: 'no-cache',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data),
                redirect: 'follow'
            })
            .then(response => {
                // 4. เมื่อสำเร็จ (แม้ 'no-cors' จะไม่ให้เราอ่าน response)
                // เราจะถือว่าการส่งสำเร็จ
                handleSuccess();
            })
            .catch(error => {
                // 5. เมื่อเกิดข้อผิดพลาด
                handleError(error.message);
            });
        });

        function handleSuccess() {
            // ปิดการโหลด
            submitButton.disabled = false;
            loadingSpinner.classList.add('d-none');
            
            // แสดงข้อความสำเร็จ
            alertSuccess.classList.remove('d-none');
            
            // ล้างฟอร์ม
            form.reset();
        }

        function handleError(message) {
            // ปิดการโหลด
            submitButton.disabled = false;
            loadingSpinner.classList.add('d-none');
            
            // แสดงข้อความล้มเหลว
            errorMessage.textContent = message;
            alertError.classList.remove('d-none');
        }

    </script>
</body>
</html>
